---
title: "the100"
output: html_document
date: "2023-07-23"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown


```{r}


library(tidyverse)


```

```{r}

na_check = vital_bat %>% filter(is.na(comp_fin)) %>%
                              group_by(comp) %>%
                                summarise(n = n())



na_check2 = fin_dat %>% group_by(comp) %>%
                              summarise(n = n())



na_check3 = vital_bat %>% filter(is.na(comp_t2))



```

```{r} 

match_teams = fin_dat %>% 
                              slice_min(innball) %>%
                                select(team, file) %>%
                                    group_by(file) %>%
                                        mutate(team3 = 1:n()) %>%
                                            mutate(teamtext = if_else(team3 == 1, "team1", "team2")) %>%
                                                select(-team3) %>%
                                                pivot_wider(names_from = teamtext, values_from = team) %>%
                    mutate(elite1 = if_else(team1 %in% c("India", "England", "New Zealand", "Pakistan", "Australia", 
                                                     "South Africa", "West Indies", "Sri Lanka", "Bangladesh", "West Indies"), 1,0)) %>%
                                          mutate(elite2 = if_else(team2 %in% c("India", "England", "New Zealand", "Pakistan", "Australia", 
                                                     "South Africa", "West Indies", "Sri Lanka", "Bangladesh", "West Indies"),1,0)) %>%
                                      mutate(elitetot = elite1 + elite2) %>%
                                             mutate(matcht = if_else(elitetot == 2, "elite", "other")) %>%
                                                select(file, matcht)






```


```{r}




vital_bat <- fin_dat %>% mutate(comp_t2 = if_else(is.na(comp_t), 
            if_else(comp %in% c("Syed Mushtaq Ali Trophy", "Bangladesh Premier League"), "Domestic", "International"), comp_t)) %>%
               mutate(comp_fin = if_else(comp_t2 == "International", "international", comp)) %>%
                 mutate(comp_fin2 = if_else(comp_fin == "NatWest T20 Blast", "Vitality Blast", comp_fin)) %>%
                    mutate(comp_fin2a = comp_fin2) %>%
                    separate(comp_fin2, into = c("x1", "x2", "x3", "x4"), sep = " ") %>%
                     mutate(comp_fin3 =   if_else(x1 == "ICC", "international", comp_fin2a)) %>%
                       left_join(match_teams, by = "file") %>%
                          mutate(comp_fin4 = if_else(matcht == "elite", "elite internation", comp_fin3)) %>%
  group_by(bat, comp_fin4) %>%
  mutate(batr = as.numeric(as.character(bat_run))) %>%
  summarise(totwpa = sum(batdelt, na.rm = T) * 100, n = n() / 10, tr = sum(batr), ball = n()) %>%
  mutate(wpa10 = totwpa / n)  %>%
  ungroup() %>%
  group_by(comp_fin4) 




```



```{r}









```




```{r}




bat_sum_in = fin_dat %>% mutate(comp_t2 = if_else(is.na(comp_t), 
            if_else(comp %in% c("Syed Mushtaq Ali Trophy", "Bangladesh Premier League"), "Domestic", "International"), comp_t)) %>%
               mutate(comp_fin = if_else(comp_t2 == "International", "international", comp)) %>%
                 mutate(comp_fin2 = if_else(comp_fin == "NatWest T20 Blast", "Vitality Blast", comp_fin)) %>%
                    mutate(comp_fin2a = comp_fin2) %>%
                    separate(comp_fin2, into = c("x1", "x2", "x3", "x4"), sep = " ") %>%
                     mutate(comp_fin3 =   if_else(x1 == "ICC", "international", comp_fin2a)) %>%
                       left_join(match_teams, by = "file") %>%
                          mutate(comp_fin4 = if_else(matcht == "elite", "elite internation", comp_fin3)) %>%
                            group_by(file, bat) %>%
                              mutate(face_b = 1:n()) %>%
                                mutate(inper = if_else(face_b < 6, "early", "rest")) %>%
                                     group_by(bat,inper, comp_fin4) %>%
                                 summarise(totwpa = sum(batdelt, na.rm = T) * 100, n = n() / 10, ball = n()) %>%
                                mutate(wpa10 = totwpa / n) %>%
                                      select(bat, inper, comp_fin4, wpa10) %>%
                                          pivot_wider(names_from = inper, values_from = wpa10) %>%
                                                  rename(early_wpa10 = early, rest_wpa10 = rest)







````



```{r}




bat_sum_ga = fin_dat %>% mutate(comp_t2 = if_else(is.na(comp_t), 
            if_else(comp %in% c("Syed Mushtaq Ali Trophy", "Bangladesh Premier League"), "Domestic", "International"), comp_t)) %>%
               mutate(comp_fin = if_else(comp_t2 == "International", "international", comp)) %>%
                 mutate(comp_fin2 = if_else(comp_fin == "NatWest T20 Blast", "Vitality Blast", comp_fin)) %>%
                    mutate(comp_fin2a = comp_fin2) %>%
                    separate(comp_fin2, into = c("x1", "x2", "x3", "x4"), sep = " ") %>%
                     mutate(comp_fin3 =   if_else(x1 == "ICC", "international", comp_fin2a)) %>%
                       left_join(match_teams, by = "file") %>%
                          mutate(comp_fin4 = if_else(matcht == "elite", "elite internation", comp_fin3)) %>%
                                mutate(gameper = if_else(innball < 37, "powerplay", 
                                                         if_else(innball > 90, "death", "mid"))) %>%
                                     group_by(bat,gameper, comp_fin4) %>%
                                 summarise(totwpa = sum(batdelt, na.rm = T) * 100, n = n() / 10, ball = n()) %>%
                                mutate(wpa10 = totwpa / n) %>%
                                      select(bat, gameper, comp_fin4, wpa10) %>%
                                          pivot_wider(names_from = gameper, values_from = wpa10) %>%
                                                  rename(pp_wpa10 = powerplay, death_wpa10 = death, mid_wpa = mid)













```




```{r}


bat_stat <- fin_dat %>% mutate(comp_t2 = if_else(is.na(comp_t), 
            if_else(comp %in% c("Syed Mushtaq Ali Trophy", "Bangladesh Premier League"), "Domestic", "International"), comp_t)) %>%
               mutate(comp_fin = if_else(comp_t2 == "International", "international", comp)) %>%
                 mutate(comp_fin2 = if_else(comp_fin == "NatWest T20 Blast", "Vitality Blast", comp_fin)) %>%
                    mutate(comp_fin2a = comp_fin2) %>%
                    separate(comp_fin2, into = c("x1", "x2", "x3", "x4"), sep = " ") %>%
                     mutate(comp_fin3 =   if_else(x1 == "ICC", "international", comp_fin2a)) %>%
                       left_join(match_teams, by = "file") %>%
                          mutate(comp_fin4 = if_else(matcht == "elite", "elite internation", comp_fin3)) %>%
  group_by(bat, comp_fin4) %>%
  mutate(batr = as.numeric(as.character(bat_run))) %>%
                        summarise(totrun = sum(batr), totballs = n())




bat_match = fin_dat %>% mutate(comp_t2 = if_else(is.na(comp_t), 
            if_else(comp %in% c("Syed Mushtaq Ali Trophy", "Bangladesh Premier League"), "Domestic", "International"), comp_t)) %>%
               mutate(comp_fin = if_else(comp_t2 == "International", "international", comp)) %>%
                 mutate(comp_fin2 = if_else(comp_fin == "NatWest T20 Blast", "Vitality Blast", comp_fin)) %>%
                    mutate(comp_fin2a = comp_fin2) %>%
                    separate(comp_fin2, into = c("x1", "x2", "x3", "x4"), sep = " ") %>%
                     mutate(comp_fin3 =   if_else(x1 == "ICC", "international", comp_fin2a)) %>%
                       left_join(match_teams, by = "file") %>%
                          mutate(comp_fin4 = if_else(matcht == "elite", "elite internation", comp_fin3)) %>%
  group_by(bat, file, comp_fin4) %>%
                            summarise(n = n()) %>%
                                ungroup() %>%
                                  group_by(bat, comp_fin4) %>%
                              summarise(inns = n())
 



bat_stat2 = bat_stat %>% left_join(bat_match, by = c("bat", "comp_fin4")) %>%
                              mutate(bpi = totballs/inn, rpi = totrun/inn) %>%
                                  select(bat, comp_fin4, bpi, rpi)









```












```{r}



bat_kpi = vital_bat %>% left_join(bat_sum_in, by = c("bat", "comp_fin4")) %>%
                            left_join(bat_sum_ga, by = c("bat", "comp_fin4"))











```